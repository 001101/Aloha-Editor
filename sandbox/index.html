<!doctype html>
<html>
	<head>
		<title>Aloha Editor</title>
		<meta charset="UTF-8">
		<link href='http://fonts.googleapis.com/css?family=Open+Sans:300,700' rel='stylesheet' type='text/css'>
		<!-- Image from: https://www.flickr.com/photos/lovingjazz/6737863743 -->
		<style>
			html {
				height: 100%;
				background: #fefdfd;
			}
			body {
				margin: 0;
				padding: 5% 20%;
				color: #565452;
				line-height: 1.6em;
				min-height: 100%;
				box-shadow: 0 0 100px rgba(0,0,0,0.2) inset;
				font-family: 'Open Sans', sans-serif;
				font-size: 16px;
				-webkit-font-smoothing: antialiased;
				   -moz-font-smoothing: antialiased;
				       -font-smoothing: antialiased;
			}
			::selection {
				background: #4285f4;
				color: #fff;
			}
			::-moz-selection {
				background: #4285f4;
				color: #fff;
			}
			p { margin: 0 0 0.5em; }
			.aloha-editable {
				padding: 1em;
				border: 1px solid #eee;
				box-shadow: 2px 2px 100px rgba(0,0,0,0.1);
			}
			.aloha-editable>:first-child { margin-top: 0; }
			.aloha-editable>:last-child { margin-bottom: 0; }
			.aloha-block {
				width: 100px;
				height: 100px;
				padding: 10px;
				color: #fff;
				text-align: center;
				display: table-cell;
				vertical-align: middle;
				background-image: -webkit-linear-gradient(50deg, #8aeae2 0%, #dcc23a 30%, #ee5577 100%);
				background-image: -moz-linear-gradient(50deg, #8aeae2 0%, #dcc23a 30%, #ee5577 100%);
			}
			code {
				border: 1px solid #ddd;
				border-radius: 0.2em;
				background: whitesmoke;
				padding: 0.2em;
			}
		</style>
	</head>
	<body>
		<div class="aloha-editable">starting<i>foobar</i><p
			><span>one</span> <u><b>two</b> <i>three</i></u></p> <h6
			>four</h6
		></div>

		<br/>

		<input value="Not an Aloha Editor element" />

		<br/><br/>

		<div class="aloha-editable">
			<h1>Aloha Editor</h1>
			<p>
				<img draggable="true"
				     src="demo.jpg"
				     alt="Some Rights Reserved. Andrea O, Connell"
				     style="float:left; width: 300px; margin: 0 20px 20px 0" />
				Lorem    ipsum &nbsp;dolor sit amet, <b>consec<i>tet</i>ur</b> adipiscin
				elit. Donec a diam lectus. Sed sit amet ipsum mauris.  Maecen
				congue ligula ac quam viverra nec consectetur ante hendrerit
			</p>
			<div draggable="true" class="aloha-block"
				data-aloha='{"hello":"word"}'>Aloha Block</div>
			<p>
				Donec et mollis dolor.  Praesent et diam eget libero egesta
				mattis sit amet vitae augue.  Nam tincidunt congue enim, u
				porta lorem lacinia consectetur. Donec ut libero sed arc
				vehicula ultricies a non tortor*
			</p>
			<ul>
				<li>one</li>
				<li>two</li>
				<li>three
					<ol>
						<li>four</li>
						<li>five</li>
						<li class="bold"><u><i>six</i></u></li>
					</ol>
					<p>seven</p>
				</li>
			</ul>
			<p>
				Donec et mollis dolor.  Praesent et diam eget libero egesta
				mattis sit amet vitae augue.
				Nam tincidunt congue enim, u porta lorem lacinia consectetur.
				Donec ut libero sed arc vehicula ultricies a non tortor
			</p>
			<p>
				Donec ut libero sed arc vehicula ultricies a non tortor
			</p>
			<ul>
				<li>one</li>
				<li>two</li>
				<li>three</li>
			</ul>
			<p>one<br><br><br>two<br>three</p>
		</div>
		<script src="../src/require-pronto.js"></script>
		<script src="../src/require-pronto.dev.js"></script>
		<script src="../build/aloha.min.js"></script>
		<script>
			(function () {
				'use strict';
				function setVersion (version) {
					var h1 = document.querySelector('h1');
					if (h1) {
						h1.innerHTML = h1.innerHTML + ': <span style="color:#df215a">' + version + '</' + 'span>';
					}
				}
				function main(aloha) {
					aloha.arrays.coerce(document.querySelectorAll('.aloha-editable')).forEach(aloha);
					aloha.metaview.toggle(document.querySelector('.aloha-editable'),{outline:true,padding: true});

					/*
					var boundaries = [
						aloha.boundaries.create(document.querySelector('.aloha-editable'), 0),
						aloha.boundaries.create(document.querySelector('.aloha-editable'), 1),
						aloha.boundaries.create(document.querySelector('.aloha-editable'), 2),
						aloha.boundaries.create(document.querySelector('.aloha-editable'), 1),
						aloha.boundaries.create(document.querySelector('i').firstChild, 1),
						aloha.boundaries.create(document.querySelector('i').firstChild, 2),
						aloha.boundaries.create(document.querySelector('i').firstChild, 2),
						aloha.boundaries.fromEndOfNode(document.querySelector('i')),
						aloha.boundaries.fromNode(document.querySelector('i')),
						aloha.boundaries.create(document.querySelector('span').firstChild, 2),
						aloha.boundaries.create(document.querySelector('i').firstChild, 3),
						aloha.boundaries.create(document.querySelector('h6').firstChild, 3)
					];
					*/

					var editable = document.querySelector('.aloha-editable');
					var boundaries = [
						/*
						aloha.boundaries.create(editable.querySelector('h6').firstChild, 2),
						aloha.boundaries.create(document.querySelector('b').firstChild, 0),
						*/
						aloha.boundaries.create(document.querySelector('b').firstChild, 1),
						/*
						aloha.boundaries.create(document.querySelector('b').firstChild, 2),
						aloha.boundaries.create(document.querySelector('b').firstChild, 3),
						aloha.boundaries.create(document.querySelector('b'), 1),
						aloha.boundaries.create(document.querySelector('b'), 1),
						aloha.boundaries.fromNode(document.querySelector('b')),
						aloha.boundaries.create(document.querySelector('b').firstChild, 2)
						*/
					];
					var limit = editable; //.querySelector('b').parentNode.parentNode;
					var splitBoundary = aloha.boundaries.create(limit.querySelector('b').firstChild, 1);
					var path = aloha.paths.fromBoundary(limit, splitBoundary);
					var tree = aloha.MutationTrees.create(limit, boundaries);
					var result = aloha.MutationTrees.split(tree, path)
					tree = result[0];
					path = result[1];
					tree = aloha.MutationTrees.insert(tree, path, [
						document.createTextNode('apple'),
						document.createTextNode('orange')
					]);
					//tree.updateDom();
					var updated = aloha.MutationTrees.update(tree);

					//console.log(updated.domNode(), aloha.markers.hint(aloha.paths.toBoundary(updated.domNode(), result[1])));
				}
				if ('undefined' === typeof aloha) {
					setVersion('src');
					require('../src/aloha', main);
				} else {
					setVersion('build');
					main(aloha);
				}
			}());
		</script>
	</body>
</html>

